import PluginVariables as msqcvar;
import readTile as rt;
import functions as fc;
import opening as op;
import Battle.battleStart as bbs;
import Item.itemInfo as iif;
import Player.playerUnit as ppu;
import Player.movementUnit as pmu;
import Player.playerSetting as pps;
import Player.soundPlay as psp;
import Player.teleportSystem as pts;
import Pokemon.myPokemon as pmp;
import Pokemon.pokemonInfo as ppi;
import Pokemon.weakRelation as pwr;
import Pokemon.calculateMethod as pcm;
import Pokemon.weaponData as pwd;
import Variables.mainSentence as vms;
import Variables.locationInfo as vli;
import Variables.flagText as vft;
import BGMPlayer as BGM;


const s = StringBuffer(1024);
function onPluginStart(){

	randomize();
	BGM.loadSound();
	rt.TilesetInit();
	ppi.pokemonInit();
	pwr.weakInit();
	pwd.weaponInit();
	pmp.pokemonListInit();
	iif.itemInit();
	fc.SpeedBan(); //방제배속방지
	fc.exitObserver(); //옵저버밴
	fc.ComputerCheck(4);
	fc.ComputerCheck(5);
	fc.ComputerCheck(6);
	fc.ComputerCheck(7);
	SetMemoryEPD(EPD(0x657A9C), SetTo, 0); //화면밝기
	SetMemory(0x5124F0, SetTo, 29); //2배속
	foreach(cp : EUDLoopPlayer(None, Force1)){
		pps.settingMusic[cp] = 1;
		RunAIScript("Turn ON Shared Vision for Player 8");
	}
}

function beforeTriggerExec(){

	SetMemory(0x6509A0, SetTo, 0); //EUD터보
	foreach(cp : EUDLoopPlayer(None, Force1)){
		setcurpl(cp);
		psp.backgroundMusic(cp);
		fc.updateLight(cp);
	}
}

function afterTriggerExec(){

	foreach(cp : EUDLoopPlayer(None, Force1)){
		setcurpl(cp);
		if(pps.mainStory[cp] == 0){op.openingStep(cp);}
		else{
			pmu.movePlayer(cp);
			vms.speechSystem(cp); //메인스토리
			vli.updateLocation(cp); //현재위치 표시
			pts.teleportPlayer(cp); //위치이동
			vft.printFlagText(cp); //표지판 텍스트
			bbs.battleSystem(cp); //배틀시스템
		}
	}
	KillUnit(33, 7); //스캔이펙트 제거
}